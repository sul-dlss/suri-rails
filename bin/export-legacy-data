#!/usr/bin/env ruby
# frozen_string_literal: true

# This script extracts the data from the legacy oracle database and writes it to CSV.
#
# before running: gem install ruby-oci8
#
# Usage:
#   export-legacy-data <user> <password> <database> > identifiers.csv

require 'ruby-oci8'
require 'csv'

conn = OCI8.new(ARGV[0], ARGV[1], ARGV[2])
columns = %w[identifier created_by created]
sql = <<~SQL
  SELECT #{columns.join(', ')} FROM identifier
SQL
CSV do |csv_out|
  csv_out << columns
  conn.exec(sql) do |r|
    csv_out << r
  end
end
